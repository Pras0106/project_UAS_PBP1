<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Nike Product Detail</title>

    <style>
        .active-size {
            background-color: black !important;
            color: white !important;
            border-color: black !important;
        }

        .selected-color {
            border: 3px solid black !important;
            background-color: rgba(156, 163, 175, 0.3) !important;
            /* gray-400 with 30% opacity */
            border-radius: 8px;
        }
    </style>

</head>

<body class="bg-white text-black">

    <div class="max-w-7xl mx-auto p-6 grid grid-cols-1 md:grid-cols-2 gap-10">

        <!-- LEFT IMAGE GALLERY -->
        <div class="flex gap-4">
            <!-- THUMBNAIL CONTAINER (dinamis) -->
            <div id="thumbnailContainer" class="flex flex-col gap-3">
                <!-- JS akan mengisi thumbnail di sini -->
            </div>

            <!-- Main Image -->
            <div class="flex-1">
                <img id="mainImage" src="../image/AIR+FORCE+1+'07+LV8.png"
                    class="rounded shadow object-cover w-full bg-gray-200">
            </div>
        </div>


        <!-- RIGHT PRODUCT INFO -->
        <div class="pr-6">

            <p class="text-sm text-gray-600 mb-1">Men's Shoe</p>
            <h1 class="text-3xl font-semibold mb-1">Nike Air Force 1 '07 LV8</h1>
            <p class="text-xl font-semibold">Rp 1.909.000</p>

            <!-- COLOR SELECTOR -->
            <p class="text-sm text-gray-600 mt-4 mb-2">2 Colours</p>
            <!-- COLOR SELECTOR -->
            <div class="flex gap-4 mb-6">
                <!-- Warna 1 (ochre) -->
                <img src="../image/AIR+FORCE+1+'07+LV8.png" class="color-btn w-24 rounded cursor-pointer selected-color"
                    data-main="../image/AIR+FORCE+1+'07+LV8.png" data-thumb1="../image/AIR+FORCE+1+'07+LV8 (1).png"
                    data-thumb2="../image/AIR+FORCE+1+'07+LV8 (2).png"
                    data-thumb3="../image/AIR+FORCE+1+'07+LV8 (3).png"
                    data-thumb4="../image/AIR+FORCE+1+'07+LV8 (4).png" data-color="Desert Ochre/Black/Desert Ochre"
                    data-style="HQ1966-700" />

                <!-- Warna 2 (white) -->
                <img src="../image/lv8 white.jpeg" class="color-btn w-24 rounded cursor-pointer"
                    data-main="../image/lv8 white.jpeg" data-thumb1="../image/AIR+FORCE+1+'07+LV8 white (1).png"
                    data-thumb2="../image/AIR+FORCE+1+'07+LV8 white (2).png"
                    data-thumb3="../image/AIR+FORCE+1+'07+LV8 white (3).png"
                    data-thumb4="../image/AIR+FORCE+1+'07+LV8 white (4).png"
                    data-color="Light Smoke Grey/Black/Light Smoke Grey" data-style="HQ1966-001" />
            </div>



            <div class="flex items-center justify-between mb-2">
                <p class="font-medium">Select Size</p>
            </div>

            <div class="grid grid-cols-3 gap-3 mb-6">
                <button class="size-btn border py-3 rounded hover:border-black">XS</button>
                <button class="size-btn border py-3 rounded hover:border-black">S</button>
                <button class="size-btn border py-3 rounded hover:border-black">M</button>
                <button class="size-btn border py-3 rounded hover:border-black">L</button>
                <button class="size-btn border py-3 rounded hover:border-black">XL</button>
            </div>

            <script>
                const sizeButtons = document.querySelectorAll('.size-btn');

                sizeButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        sizeButtons.forEach(b => b.classList.remove('active-size'));
                        btn.classList.add('active-size');
                    });
                });
            </script>


            <button class="w-full bg-black text-white py-4 rounded-full mb-3 hover:bg-gray-900">
                Add to Bag
            </button>

            <button id="favBtn" class="w-full border py-4 rounded-full mb-8 hover:bg-gray-100">
                Favourite <span id="heart">♡</span>
            </button>

            <p class="text-gray-700 leading-relaxed mb-6">
                Comfortable, durable and timeless – it’s number one for a reason.
                This edition puts a fresh twist on the classic with hydrated suede overlays
                and heritage style. Step into a legend.
            </p>

            <ul class="list-disc ml-6 text-gray-700 mb-6">
                <p class="font-bold">Benefits</p>
                <li>The suede upper with a perforated toe box is breathable and comfortable.</li>
                <li>Originally designed for performance hoops, Nike Air cushioning adds lightweight, all-day comfort.
                </li>
                <li>The rubber outsole with heritage hoops pivot circles delivers traction and durability.</li>
                <br>
                <p class="font-bold">Product Details</p>
                <li>Padded collar</li>
                <li>Foam midsole</li>
                <li id="colorShown">Color Shown: Desert Ochre/Black/Desert Ochre</li>
                <li id="styleCode">Style: HQ1966-700</li>
                <li>Country/Region of Origin: Vietnam</li>
            </ul>

            <div class="border-t pt-4">
                <button id="openReviews" class="w-full flex justify-between items-center py-3 text-left font-semibold">
                    Reviews
                </button>
            </div>

        </div>
    </div>

    <!-- === JAVASCRIPT UNTUK GANTI GAMBAR, THUMBNAIL, WARNA, DAN FAVOURITE === -->
    <script>
        /* -------- select elements -------- */
        const colorBtns = document.querySelectorAll(".color-btn");
        const mainImg = document.getElementById("mainImage");
        const thumbnailContainer = document.getElementById("thumbnailContainer");
        const colorShownText = document.getElementById("colorShown");
        const styleCodeText = document.getElementById("styleCode");
        const favBtn = document.getElementById("favBtn");
        const heart = document.getElementById("heart");

        /* -------- helper: collect thumbs from attributes -------- */
        function collectThumbsFromBtn(btn) {
            // data-thumb1..data-thumb4 (ambil jika ada)
            const thumbs = [];
            for (let i = 1; i <= 8; i++) { // support up to 8 thumbs if dibutuhkan
                const key = 'thumb' + i;
                const v = btn.dataset[key];
                if (v && v.trim() !== '') thumbs.push(v);
            }
            return thumbs;
        }

        /* -------- update thumbnails DOM -------- */
        function updateThumbnails(thumbArray) {
            thumbnailContainer.innerHTML = ""; // kosongkan dulu
            thumbArray.forEach(src => {
                const img = document.createElement("img");
                img.src = src;
                img.className = "thumbnail w-24 rounded cursor-pointer hover:opacity-80 bg-gray-200";
                img.addEventListener("click", () => mainImg.src = src);
                thumbnailContainer.appendChild(img);
            });
        }

        /* -------- color button click handler -------- */
        colorBtns.forEach(btn => {
            btn.addEventListener("click", () => {
                // highlight
                colorBtns.forEach(b => b.classList.remove("selected-color"));
                btn.classList.add("selected-color");

                // ganti main
                if (btn.dataset.main) mainImg.src = btn.dataset.main;

                // collect thumbs and update
                const thumbs = collectThumbsFromBtn(btn);
                if (thumbs.length) updateThumbnails(thumbs);

                // update texts
                if (colorShownText) colorShownText.textContent = "Color Shown: " + (btn.dataset.color || "");
                if (styleCodeText) styleCodeText.textContent = "Style: " + (btn.dataset.style || "");
            });
        });

        /* -------- initialize: pilih warna pertama jika ada -------- */
        const firstColor = document.querySelector(".color-btn.selected-color") || document.querySelector(".color-btn");
        if (firstColor) {
            // trigger a click programmatically to populate thumbnails + main image + texts
            firstColor.click();
        }

        /* -------- favourite button -------- */
        if (favBtn && heart) {
            favBtn.addEventListener("click", () => {
                heart.textContent = heart.textContent === "♡" ? "❤️" : "♡";
            });
        }
    </script>

    <!-- ===== POPUP REVIEW STYLE NIKE ===== -->
    <div id="reviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">

        <div class="absolute right-0 top-0 w-full md:w-[85%] h-full bg-white p-6 overflow-y-scroll">

            <!-- TOP BAR -->
            <div class="flex justify-between items-start mb-6">
                <div class="flex items-center gap-3">
                    <img src="https://i.imgur.com/czi6K5w.png" class="w-16">
                    <div>
                        <h2 class="text-xl font-semibold">Nike Air Force 1 '07 LV8</h2>
                        <p class="text-gray-700">Rp 1.909.000</p>
                    </div>
                </div>

                <button id="closeReviews" class="text-3xl font-light hover:text-gray-600">
                    ✕
                </button>
            </div>

            <!-- MAIN SUMMARY -->
            <div class="grid md:grid-cols-3 gap-6 border-b pb-6">

                <!-- RATING SUMMARY -->
                <div class="border-b pb-6">
                    <p class="text-4xl font-bold"><span id="avgRating">0</span><span class="text-xl font-normal"> /
                            5</span></p>
                    <p class="text-yellow-500 text-3xl mt-1" id="avgStars">☆☆☆☆☆</p>

                    <button id="openWriteForm"
                        class="mt-4 px-5 py-2 border rounded-full bg-black text-white hover:bg-gray-800">
                        Write a Review ✎
                    </button>
                </div>


                <hr class="mb-6">

                <!-- ================= WRITE REVIEW FORM ================= -->
                <div id="writeForm" class="hidden mt-10">

                    <h1 class="text-xl font-semibold mb-1">Write a Review</h1>
                    <p class="text-gray-600 mb-6">Share your thoughts with the community.</p>

                    <!-- RATING -->
                    <p class="font-semibold mb-1">Overall rating *</p>
                    <div id="starSelect" class="flex text-4xl cursor-pointer mb-4 text-gray-400">
                        <span data-rate="1">★</span>
                        <span data-rate="2">★</span>
                        <span data-rate="3">★</span>
                        <span data-rate="4">★</span>
                        <span data-rate="5">★</span>
                    </div>

                    <!-- REVIEW TEXT -->
                    <p class="font-semibold mb-1">Your Review *</p>
                    <textarea id="reviewText" class="w-full border p-3 rounded mb-4" rows="5"></textarea>

                    <!-- TITLE -->
                    <p class="font-semibold mb-1">Review title</p>
                    <input id="reviewTitle" class="w-full border p-3 rounded mb-6">

                    <!-- SIZE SELECTOR -->
                    <p class="font-semibold mb-1">Size you normally wear</p>
                    <select id="reviewSize" class="border p-3 rounded w-40 mb-6">
                        <option value="">Select one</option>
                        <option>XS</option>
                        <option>S</option>
                        <option>M</option>
                        <option>L</option>
                        <option>XL</option>
                    </select>

                    <!-- SUBMIT -->
                    <button id="submitReview"
                        class="w-full bg-black text-white py-3 rounded-full font-semibold hover:bg-gray-900">
                        Submit
                    </button>

                    <hr class="my-8">
                </div>

                <!-- LIST REVIEW -->
                <div id="reviewList" class="space-y-10"></div>


            </div>

            <div class="h-20"></div> <!-- bottom padding -->

        </div>

    </div>

    <script>
        const modal = document.getElementById("reviewModal");
        const openBtn = document.getElementById("openReviews");
        const closeBtn = document.getElementById("closeReviews");

        openBtn.addEventListener("click", () => {
            modal.classList.remove("hidden");
        });

        closeBtn.addEventListener("click", () => {
            modal.classList.add("hidden");
            resetReviewForm();
        });


        // optional: klik area gelap untuk close
        modal.addEventListener("click", (e) => {
            if (e.target === modal) modal.classList.add("hidden");
        });
    </script>

    <script>
        let reviews = [];
        let selectedRating = 0;

        // === 1. LOAD DATA DARI JSON (GET) ===
        async function loadReviews() {
            try {
                const response = await fetch("./review/Nike_Air_Force_107_LV8_Reviews.json");
                reviews = await response.json();
            } catch (err) {
                console.error("Gagal load JSON:", err);
                reviews = [];
            }

            updateReviewList();
            updateSummaryRating();
        }

        loadReviews();


        // === 2. OPEN WRITE FORM ===
        document.getElementById("openWriteForm").onclick = () => {
            document.getElementById("writeForm").classList.remove("hidden");
        };


        // === 3. RATING SELECT ===
        document.querySelectorAll("#starSelect span").forEach(star => {
            star.addEventListener("click", () => {
                selectedRating = star.dataset.rate;

                document.querySelectorAll("#starSelect span").forEach(s => {
                    s.style.color = (s.dataset.rate <= selectedRating) ? "gold" : "lightgray";
                });
            });
        });


        // === 4. SUBMIT REVIEW (POST KE SERVER) ===
        document.getElementById("submitReview").onclick = async () => {
            let text = document.getElementById("reviewText").value.trim();
            let title = document.getElementById("reviewTitle").value.trim();
            let size = document.getElementById("reviewSize").value;

            // ==== VALIDASI WAJIB ====
            if (!selectedRating) {
                alert("Please select an Overall Rating.");
                return;
            }

            if (text.length === 0) {
                alert("Please write your review.");
                return;
            }

            if (title.length === 0) {
                alert("Please enter a review title.");
                return;
            }

            if (size === "") {
                alert("Please choose your size.");
                return;
            }
            // =========================

            let newReview = {
                rating: selectedRating,
                title,
                text,
                size
            };

            try {
                await fetch("/reviews", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(newReview)
                });

                reviews.push(newReview);
            } catch (err) {
                console.error("Gagal upload review:", err);
                alert("Error saving review to server.");
                return;
            }

            updateReviewList();
            updateSummaryRating();
            resetReviewForm();

            document.getElementById("reviewList").scrollIntoView({ behavior: "smooth" });
        };

        // === 5. SUMMARY RATING ===
        function updateSummaryRating() {
            if (reviews.length === 0) return;

            let avg = reviews.reduce((a, b) => a + Number(b.rating), 0) / reviews.length;
            document.getElementById("avgRating").textContent = avg.toFixed(1);

            let filled = "★".repeat(Math.round(avg));
            let empty = "☆".repeat(5 - Math.round(avg));
            document.getElementById("avgStars").textContent = filled + empty;
        }


        // === 6. LIST REVIEW ===
        function updateReviewList() {
            const list = document.getElementById("reviewList");
            list.innerHTML = "";

            reviews.forEach(r => {
                let stars = "★".repeat(r.rating) + "☆".repeat(5 - r.rating);

                list.innerHTML += `
                <div class="border-b pb-6">
                    <p class="text-yellow-500 text-xl">${stars}</p>

                    <div class="mt-2">
                        <p class="font-bold">${r.title || "REGINALD"}</p>
                        <p class="mt-1 text-gray-800 leading-relaxed">${r.text}</p>
                        <p class="mt-4 text-gray-600">Size you normally wear: ${r.size}</p>
                    </div>
                </div>
            `;
            });
        }


        // === 7. RESET FORM ===
        function resetReviewForm() {
            selectedRating = 0;
            document.querySelectorAll("#starSelect span").forEach(s => {
                s.style.color = "lightgray";
            });

            document.getElementById("reviewText").value = "";
            document.getElementById("reviewTitle").value = "";
            document.getElementById("reviewSize").value = "";

            document.getElementById("writeForm").classList.add("hidden");
        }
    </script>

</body>

</html>